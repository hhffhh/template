<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>JMS</title>
</head>
<body>

<textarea name="" id="a" cols="90" rows="16">
    \#112312312312#each #{!html.toLocalString()}
    <UL>
        # if (parseInt(foo,10) > 0 )
        # var abc=123
        <li>#{!name}</li>
        # else if ( foo == "hello world")
        <li>#{!else}</li>
        #elseif (foo=123)
        <li class="none">$name</li>
        #else
        <li class="none">#{a.toLocalString()}</li>
        #endif
        #script
        var a=123;
        function hello(){

        }
    </UL>
    #end

</textarea>


<pre id="b">

</pre>
<script type="text/javascript">
    var a = document.getElementById('a');
    var b = document.getElementById('b');

    //var arr = a.value.match(/[^\\]?#[a-z]+[^#\r\n]*/gmi);
    var arr = a.value.split(/[\r\n]/gmi);
    var exec = [];

    arr.forEach(function (item, index) {
        //匹配IF

        if (/^[\s]*##/i.test(item)) {
            return;
        }
        if (/^[\s]*[\\]+#/i.test(item)) {
            exec.push(item.replace(/^[\s]*[\\]+#/i, ''));
        }
        var _item = item.match(/#[\s]*(each|if|elseif|else if|endif|end)[\s]*(\([^#]*\))?/);
        if (_item) {
            switch (RegExp.$1) {
                case 'each':
                    exec.push('json123.forEach(function(item,index,arr){');
                    break;
                case 'if':
                    exec.push(RegExp.$1 + RegExp.$2 + '{');
                    break;
                case 'elseif':
                    exec.push('}else if' + RegExp.$2 + '{');
                    break;
                case 'else if':
                    exec.push('}' + RegExp.$1 + RegExp.$2 + '{');
                    break;
                case 'endif':
                    exec.push('}');
                    break;
                case 'end':
                    exec.push('})');
                    break;

            }
        }

    });
    console.log(exec.join('\r\n'));


</script>
</body>
</html>
