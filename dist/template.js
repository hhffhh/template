define("template/template/1.0.0/template",["./split","./json2"],function(require,exports,module){"use strict";function temporaryProtection(_){for(var A=0;placeholderFlag.length>A;A++){var e=placeholderFlag[A];_=_.replace(e[0],e[1].source)}return _=_.replace(/#js([\s\S]*?)#end/gm,"AMS_FLAG_JS$1AMS_FLAG_ENDJS")}function revertProtection(_){for(var A=0;placeholderFlag.length>A;A++){var e=placeholderFlag[A];_=_.replace(e[1],e[2])}return _}function replaceElse(_){return _=_.replace(/#(elseif)[\s]*(\([^)]+\)){1}/gm,"AMS_FLAG_ELSEIF$2"),_=_.replace(/#else/gm,"AMS_FLAG_ELSE"),_=_.replace(/AMSTEMPBLOCKS==(.*)==/gm,"\\#$1")}function translateIF(_){function A(){if(/#end/.test(_)){var e=_.match(/[\s\S]+?#end/)[0],l="";if(/#(if|each|js)/gm.test(e)){for(var a=[],E=0;r.length>E;E++){var M=r[E],n=e.lastIndexOf(M);n>-1&&a.push(n)}e=e.substring(Math.max.apply(null,a));var s=e.match(t),F=s[0].substring(1),L="",p="";"if"==F?(L="AMS_FLAG_IF",p="AMS_FLAG_ENDIF"):"each"==F?(L="AMS_FLAG_EACH",p="AMS_FLAG_ENDEACH"):"js"==F&&(L="AMS_FLAG_JS",p="AMS_FLAG_ENDJS"),l=e.replace(S,L+"$1"+p),"if"===F&&(l=replaceElse(l)),_=_.replace(e,l)}else l=e.substring(0,e.length-4),_=_.replace(e,l);A()}}function e(A){var e=/[\\]+#\{([^}]+)\}/gm;_=A.replace(e,"AMS_VARIABLE_COMMENT$1}"),_=_.replace(/#\{([^}]+)\}/gm,"AMS_PLACEHOLDER_START--$1--AMS_PLACEHOLDER_END")}_=temporaryProtection(_);var r=["#if","#each","#js"],t=/#(if|each|js)/gm,S=/(?:#if|#each|#js)([\s\S]+?)#end/gm;return A(),e(_),_}function transportOperation(_){var A=/(AMS_FLAG_IF|AMS_FLAG_ELSEIF){1}(?:[\s]*([^)]+?\)))(.*?)(?=AMS_FLAG_ELSEIF|AMS_FLAG_ELSE|AMS_FLAG_ENDIF|AMS_FLAG_EACH|AMS_FLAG_JS|[\r\n])/gm;return _=_.replace(A,"$1AMS_OPERATION--$2--AMS_OPERATION$3")}function transportJS(_){var A=/AMS_FLAG_JS(?:[\s\S]+?)AMS_FLAG_ENDJS/gm,e=_.match(A);if(e)for(var r=0;e.length>r;r++){var t=e[r],S=t.match(/AMS_FLAG_JS([\s\S]+?)AMS_FLAG_ENDJS/);S&&(_=_.replace(t,"AMS_FLAG_JS"+encodeURIComponent(S[1])+"AMS_FLAG_ENDJS"))}return _}function transportVar(_){return _=_.replace(/^[\s]*#run(.+?)$/gm,"AMS_RUN_START$1AMS_RUN_END")}function render(value,AMS_DATA){var tpl,html,head='var AMS_RENDER=" ";\r\n;function echo(s){AMS_RENDER+=s;}\r\n';for(var k in AMS_DATA)AMS_DATA.hasOwnProperty(k)&&(head+="var "+k+" = AMS_DATA."+k+";\r\n");var _tpl;html=" ",tpl=translateIF(value),tpl=transportJS(tpl),tpl=transportOperation(tpl),tpl=transportVar(tpl),tpl=revertProtection(tpl),_tpl=tpl.split(/[\r\n]/);for(var l=0;_tpl.length>l;l++){for(var str=_tpl[l],arr=split(str,IF_FLAG),i=0;arr.length>i;i++){var _str=arr[i];IF_FLAG.test(_str)?/AMS_FLAG_IFAMS_OPERATION/.test(_str)?html+=_str.replace(/AMS_FLAG_IFAMS_OPERATION--(.+?)--AMS_OPERATION/g,"if $1 {"):/AMS_FLAG_ELSEIFAMS_OPERATION/.test(_str)?html+=_str.replace(/AMS_FLAG_ELSEIFAMS_OPERATION--(.+?)--AMS_OPERATION/,"} else if $1 { "):"AMS_FLAG_ELSE"===_str?html+=_str.replace(/AMS_FLAG_ELSE/,"} else {"):"AMS_FLAG_ENDIF"===_str?html+=_str.replace(/AMS_FLAG_ENDIF/gm,"}"):/AMS_FLAG_EACH/.test(_str)?html+=_str.replace(forEachRe,function(_){var A=_.match(forEachRe),e=A[1].split(","),r=A[2],t=e.length>1?e[1]:"index"+parseInt(1e12*Math.random(),10),S=e[2]?e[2]:r;return""+(e[2]?"var "+e[2]+"="+r+";":"")+"\r\n"+"for(var "+t+"=0;"+t+"<"+S+".length;"+t+"++){\r\n"+"var "+e[0]+"="+S+"["+t+"];\r\n"}):"AMS_FLAG_ENDEACH"===_str?html+=_str.replace(/AMS_FLAG_ENDEACH/gm,"};"):/AMS_PLACEHOLDER_START/.test(_str)?html+=_str.replace(/AMS_PLACEHOLDER_START--(.+?)--AMS_PLACEHOLDER_END/,"echo($1);"):/AMS_FLAG_JS/.test(_str)?(_str.match(/AMS_FLAG_JS(.+?)AMS_FLAG_ENDJS/),html+=_str.replace(/AMS_FLAG_JS(.+?)AMS_FLAG_ENDJS/,decodeURIComponent(_str.match(/AMS_FLAG_JS(.+?)AMS_FLAG_ENDJS/)[1])+"\r\n")):/AMS_RUN_START/.test(_str)&&(html+=_str.replace(/AMS_RUN_START(.+?)AMS_RUN_END/,"$1")):_str.length>0&&(html+='AMS_RENDER+="'+_str.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'";'),_str.length>0&&(html+="\r\n"),i===arr.length-1&&(html+='AMS_RENDER+="\\r\\n";')}html+="\r\n"}return eval(head+html)}var split=require("./split").split,JSON=require("./json2").JSON,placeholderFlag=[[/\\#if/gm,/AMS_IF_COMMENT/gm,"#if"],[/\\#elseif/gm,/AMS_ELSEIF_COMMENT/gm,"#elseif"],[/\\#else/gm,/AMS_ELSE_COMMENT/gm,"#else"],[/\\#each/gm,/AMS_EACH_COMMENT/gm,"#each"],[/\\#end/gm,/AMS_END_COMMENT/gm,"#end"],[/\\#run/gm,/AMS_RUN_COMMENT/gm,"#run"],[/\\#js/gm,/AMS_JS_COMMENT/gm,"#js"],[/\\#\{/,/AMS_VARIABLE_COMMENT/,"#{"],[/\$/gim,/AMS_RE/gm,"$"],[/\\\)/gim,/AMS_CLOSE/gm,")"]],OPEN_IF=["AMS_FLAG_IFAMS_OPERATION","AMS_FLAG_ELSEIFAMS_OPERATION"],CLOSE_IF="AMS_OPERATION",IF_FLAG=RegExp("("+OPEN_IF[0]+"--(?:.+?)--"+CLOSE_IF+"|"+OPEN_IF[1]+"--(?:.+?)--"+CLOSE_IF+"|"+"AMS_FLAG_EACH(?:\\([^)]+?\\))|"+"AMS_PLACEHOLDER_START"+"--(?:.+?)--"+"AMS_PLACEHOLDER_END|"+"AMS_FLAG_JS(?:.+?)AMS_FLAG_ENDJS|"+"AMS_RUN_START(?:.+?)AMS_RUN_END|"+"AMS_FLAG_ELSE|AMS_FLAG_ENDIF|AMS_FLAG_ENDEACH)","gm"),forEachRe=/AMS_FLAG_EACH\((.+?)[\s]+in[\s]+([^\s]+)\)/;module.exports?module.exports=render:window.template=template});
